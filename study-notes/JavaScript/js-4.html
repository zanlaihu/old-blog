<!DOCTYPE html>
<html>
  <head>
    <title>Hu Zanlai Website</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1,
			user-scalable=no"
    />
    <link rel="stylesheet" href="../../assets/css/main.css" />
  </head>

  <body class="body-style">
    <div>
      <!-- Header -->
      <div class="news news-purple">
        <div class="news-text">更新时间：</div>
      </div>

      <!-- navigation -->
      <div class="navigation navigation-shadow">
        <div class="study-logo">
          <p>学习笔记</p>
          <div class="sidebar-icon"></div>
        </div>
        <!-- 横版 -->
        <div class="navigation-content navigation-content-unhome">
          <div class="logo logo-center">Hu</div>
          <div class="navigation-choice navigation-choice-unhome">
            <a>
              <div class="choice choice-study">主页</div>
            </a>
            <a>
              <div
                class="choice choice-study choice-focused choice-focused-study"
              >
                学习笔记
              </div>
            </a>
            <a>
              <div class="choice choice-study">专业技能</div>
            </a>
            <a>
              <div class="choice choice-study">项目经历</div>
            </a>
            <a>
              <div class="choice choice-study">关于本站</div>
            </a>
            <a href="https://github.com/zanlaihu">
              <div class="github github-black"></div>
            </a>
          </div>
          <div class="inner-header-icon inner-header-icon-unhome">
            <span> </span>
            <span> </span>
          </div>
        </div>
        <!-- 下拉 -->
        <div class="dropdown">
          <div class="dropdown-line dropdown-line-black"></div>
          <div class="dropdown-menu dropdown-menu-black">
            <a>
              <p>主页</p>
            </a>
            <hr />
            <a>
              <p>学习笔记</p>
            </a>
            <hr />
            <a>
              <p>专业技能</p>
            </a>
            <hr />
            <a>
              <p>项目经历</p>
            </a>
            <hr />
            <a>
              <p>关于本站</p>
            </a>
            <hr />
            <a href="https://github.com/zanlaihu">
              <p>GitHub</p>
            </a>
            <hr />
          </div>
        </div>
        <!-- 侧边栏 -->
        <div class="sidebar"></div>
      </div>

      <div class="outline"></div>

      <div class="right-content">
        <div class="content-content">
          <h1>变量声明</h1>
          <p>
            这章补充了 typescript 官方网站对于变量声明的知识：
            <a
              href="https://www.tslang.cn/docs/handbook/variable-declarations.html"
              >https://www.tslang.cn/docs/handbook/variable-declarations.html</a
            ><br /><br />

            ECMAScript
            中的变量是松散类型，可以用于保存任何类型的数据。每个变量只不过是一个用于保存任意值的命名占位符。<br />

            声明变量的关键字有三个：var, const, let。其中 const, let 只能在
            ECMAScript 及更晚的版本中使用。<br />
          </p>

          <h2>var</h2>
          <pre><code>
            var message;
          </code></pre>
          <p>
            可以用它保存任何类型的值。严格模式下，不能定义名为 eval 和 arguments
            的变量。<br /><br />

            ECMAScript
            实现变量初始化，可以同时定义变量并设置它的值。这样初始化的变量不会被标识为字符串类型。不初始化的情况下，变量会保存一个特殊值
            undefined。
          </p>
          <pre><code>
            var message = "hi";
          </code></pre>
          <br />

          <p>定义好之后，不仅可以改变值，甚至可以改变它的类型。</p>
          <pre><code>
            var message = "hi";
            message = 100;
          </code></pre>
          <p>这样虽然是合法的，但是不推荐，也很少有看到程序员会这样做。</p>

          <h3>多个变量可以一次声明</h3>
          <p>
            因为 ECMAScript
            是松散类型，所以使用不同数据类型初始化也可以用一条语句。
          </p>
          <pre><code>
            var message = "hi",
                found = "false",
                age = 29;
          </code></pre>

          <h3>可以重复声明同一个变量</h3>
          <pre><code>
            var age = 16;
            var age = 26;
            var age = 36;
          </code></pre>

          <h3>var 声明作用域</h3>
          <p>
            使用 var
            声明的变量会成为包含它的函数的局部变量。比如，在一个函数内部 var
            一个变量，这个变量将在函数退出时被销毁。
          </p>
          <pre><code>
            function test() {
              var message = "hi";
            }
            test();
            console.log(message); // 报错
          </code></pre>
          <p>
            message
            在函数调用完后已经被销毁，试图打印的时候就会报错。这种时候可以省略
            var，将其声明为全局变量。但要慎用这种方法，严格模式下，会抛出
            referenceError。并且也会让人困惑是故意这样还是不小心写错了。
          </p>
          <pre><code>
            function test() {
              message = "hi";
            }
            test();
            console.log(message);
          </code></pre>

          <h3>var 变量声明提升(hoist)。</h3>
          <pre><code>
            console.log(age);
            var age = 26;
            function test() {
              console.log(age);
              var age = 30;
            }
          </code></pre>
          <p>
            没有报错并不是解析器没有按顺序。而是 var
            变量声明会被提升，它实际上是：
          </p>
          <pre><code>
            var age;
            console.log(age);
            age = 26;
            function test() {
              var age;
              console.log(age);
              var age = 30;
            }
          </code></pre>
          <h2>声明的全局变量和函数都会变成 window 对象的属性和方法</h2>

          <h2>let</h2>
          <p>
            let 声明的是块作用域， var
            声明的是函数作用域。这是他们最明显的区别。
          </p>
          <pre><code>
            if (true) {
              var name = "Matt";
              console.log(name); // Matt
            }
            console.log(name); // Matt
          </code></pre>
          <p>if是块作用域，被包含在函数作用域内</p>
          <pre><code>
            if (true) {
              let name = "Matt";
              console.log(name); // Matt
            }
            console.log(name); // undefined
          </code></pre>
          <p>用 let 声明的变量只能在 if 块内使用，它的作用域范围比 var 小。</p>
          <h3>不允许反复声明同一个变量（声明屏蔽）</h3>
          <p>
            会报 SyntaxError。<br />而正因为 let
            声明作用域在块内，所以嵌套使用相同的标识符合法：
          </p>
          <pre><code>
            let age = 30;
            if (true) {
              let age = 26;
            }
          </code></pre>

          <h3>let 没有变量声明提升，只有暂时性死区</h3>
          <p>
            在 let 声明之前的执行瞬间被称为暂时性死区(temporal dead
            zone)，会抛出 ReferenceError 这个错误。
          </p>

          <h3>let 全局声明的变量不会成为 window 对象的属性</h3>
          <pre><code>
            var name = "Matt";
            console.log(window.name); // Matt
            
            let age = 26;
            console.log(window.age); // undefined
          </code></pre>

          <h3>let 不能用条件声明</h3>
          <pre><code>
            if (typeof name === "undefined") {
              let name;
            }
          </code></pre>
          <p>
            像这样有条件的情况下声明的 let
            变量依旧只能在块内使用，不能在有条件的情况下声明出全局的 let
            变量。<br />
            不能使用条件声明其实是一件好事，因为条件声明是一种反模式。它让程序更难理解和维护。本来也有更好的方式去代替它。
          </p>

          <h3>for 循环中的 let</h3>
          <p>使用 var 声明的迭代变量会渗透到循环体外部：</p>
          <pre><code>
            for (var i = 0; i < 5; i++) {
              // 循环逻辑
            }
            console.log(i); // 5
          </code></pre>
          <p>let可以避免这个问题：</p>
          <pre><code>
            for (let i = 0; i < 5; i++) {
              // 循环逻辑
            }
            console.log(i); // ReferenceError: i没有定义
          </code></pre>
          <p>使用 var 时还有一个问题，经常被拿来当面试题：</p>
          <pre><code>
            for (var i = 0; i < 5; i++) {
              setTimeout(() => console.log(i), 0);
            }
          </code></pre>
          <p>
            预想的是输出：0 1 2 3 4<br />

            但实际输出的却是：5 5 5 5 5<br />

            因为 setTimeout
            是一个超时逻辑，它会在循环退出后再开始执行，而循环退出时，迭代变量保存的是导致循环退出的值：5。所有的
            i 都是同一个变量，因而输出的都是同一个最终值。
            可以用立即执行的函数表达式（IIFE）来捕获每次迭代时 i 的值。
          </p>
          <pre><code>
            for (var i = 0; i < 5; i++) {
              (function (i) {
                setTimeout(() => console.log(i), 0);
              })(i);
            }
            </code></pre>
          <p>
            或者使用 let 声明迭代变量。 JavaScript
            会在后台为每个迭代循环声明一个新的迭代变量。所以它会有 5 个
            i，值分别是 0、1、2、3、4，每个 setTimeout
            引用的都是不同的变量实例。
          </p>
          <pre><code>
            for (let i = 0; i < 5; i++) {
              setTimeout(() => console.log(i), 0);
            }
          </code></pre>
          <p>
            这种每次迭代都声明一个独立变量实例的行为适用于所有风格的 for
            循环，包括 for-in 和 for-of 循环。
          </p>

          <h2>const</h2>
          <p>
            const 与 let
            基本相同，唯一重要区别是它声明变量时必须同时初始化变量，且声明后的值不能修改。
            const 也不允许重复声明，作用域也是块。const 全局声明的变量不会成为
            window 对象的属性<br /><br />

            但是 const 只限制它指向的变量，也就是说，如果 const
            声明了一个对象，那么修改对象内的属性合法。
          </p>
          <p>
            const 一般不用来声明迭代变量，因为它不会被修改。但是在 for-in 和
            for-of 中却是有意义的：
          </p>
          <pre><code>
            for (const i = 0; i < 5; i++) {} // TypeError: 给常量赋值

            let i = 0;
            for (const j = 0; i < 5; i++) {
              console.log(j);
            }
            // 0 0 0 0 0
            
            for (const key in { a: 1, b: 2 }) {
              console.log(key);
            }
            // a b
            
            for (const value of [1, 2, 3, 4, 5]) {
              console.log(value);
            }
            // 1 2 3 4 5
          </code></pre>

          <h2>推荐使用let和const</h2>
          <p>
            let 和 const 支持更精确地声明作用域和语义。const
            声明的变量在浏览器运行时强制保持不变，方便静态代码分析工具提前发现不合法的赋值操作。
          </p>
        </div>
      </div>
    </div>
    <!-- bottom -->
    <div class="bottom">
      <div class="bottom-contact">
        <div class="contact-title">联系方式</div>
        <div class="contact-message">邮箱：klaus@outlook.com</div>
      </div>
      <div class="bottom-line"></div>
      <div class="bottom-label">Made with ❤️ by Zanlai.</div>
    </div>

    <!-- JavaScript -->
    <script src="../../assets/js/jquery-3.6.0.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/js-common.js"></script>
  </body>
</html>
